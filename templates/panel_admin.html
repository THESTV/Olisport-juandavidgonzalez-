<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Panel Admin | OliSport" />

    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" crossorigin="anonymous" />

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style-responsive.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}" />

    <title>Panel de Administración | OliSport</title>
</head>

<body>

<header>
    <nav class="navbar">
        <div class="nav-container">

            <div class="logo">
                <a href="{{ url_for('index') }}">
                    <img src="{{ url_for('static', filename='img/portfolio/logo-olisport.PNG') }}" alt="logo">
                </a>
            </div>

            <ul class="nav-links-left">
                <li><a href="{{ url_for('index') }}">Inicio</a></li>

                {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('panel_trabajador') }}">Trabajador</a></li>
                    <li><a href="{{ url_for('panel_admin') }}" class="current">Administración</a></li>
                {% endif %}
            </ul>

            <ul class="nav-links-right">
                {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('perfil') }}">Mi Perfil</a></li>
                    <li><a href="{{ url_for('logout') }}">Cerrar sesión</a></li>
                {% else %}
                    <li><a href="{{ url_for('login') }}">Iniciar sesión</a></li>
                    <li><a href="{{ url_for('register') }}">Registrarse</a></li>
                {% endif %}
            </ul>

            <div class="hamburger" id="hamburger">☰</div>

            <div class="hamburger-menu" id="hamburgerMenu">
                <a href="{{ url_for('about') }}">Quiénes somos</a>
                <a href="{{ url_for('servicio') }}">Servicios</a>
                <a href="{{ url_for('contact') }}">Contáctanos</a>
            </div>

            <hr />
        </div>
    </nav>
</header>

<main>

<section class="banner-header-p1-index">
    <div class="banner-header">
        <div class="banner-header-text">
            <h1 class="banner-title-index">Panel de <span>Administración</span></h1>

            <div class="text-description-index">
                <hr />
                <p>
                    Bienvenido <strong>{{ usuario.nombre }}</strong>.
                    Aquí puedes gestionar usuarios, roles y whitelist.
                </p>
            </div>
        </div>
    </div>
</section>


<section class="section Catalogo">
    <div class="container-catalogo">
        <h3 class="title">USUARIOS REGISTRADOS</h3>
    </div>
</section>


<section>
    <div class="admin-card">

        <table class="tabla-usuarios">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Correo</th>
                    <th>Rol</th>
                    <th>Whitelist</th>
                    <th class="acciones-th">Acciones</th>
                </tr>
            </thead>

            <tbody>
            {% for u in usuarios %}
                {% set es_admin_principal = (u.correo == "admin@olisport.com") %}

                <tr>
                    <td>{{ u.id }}</td>
                    <td>{{ u.nombre }}</td>
                    <td>{{ u.correo }}</td>

                    <td>
                        {% if u.rol == "admin" %}
                            <span class="badge admin">Admin</span>
                        {% elif u.rol == "trabajador" %}
                            <span class="badge trabajador">Trabajador</span>
                        {% else %}
                            <span class="badge usuario">Usuario</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if u.whitelist %}
                            <span class="badge ok">Autorizado ✔</span>
                        {% else %}
                            <span class="badge no">No autorizado</span>
                        {% endif %}
                    </td>

                    <td class="acciones-td">


                        <!-- WHITELIST -->
                        {% if not es_admin_principal %}
                            {% if u.whitelist %}
                                <a href="{{ url_for('desautorizar_usuario', id_usuario=u.id) }}" class="btn rojo small">
                                    Quitar autorización
                                </a>
                            {% else %}
                                <a href="{{ url_for('autorizar_usuario', id_usuario=u.id) }}" class="btn verde small">
                                    Autorizar
                                </a>
                            {% endif %}
                        {% endif %}

                        <!-- CAMBIO DE ROL (POST) -->
                        {% if not es_admin_principal %}

                            <form action="{{ url_for('cambiar_rol', id_usuario=u.id) }}" method="POST" style="display:inline;">
                                <input type="hidden" name="rol" value="admin">
                                <button class="btn azul small" {% if u.rol == 'admin' %}disabled{% endif %}>Hacer Admin</button>
                            </form>

                            <form action="{{ url_for('cambiar_rol', id_usuario=u.id) }}" method="POST" style="display:inline;">
                                <input type="hidden" name="rol" value="trabajador">
                                <button class="btn amarillo small" {% if u.rol == 'trabajador' %}disabled{% endif %}>Hacer Trabajador</button>
                            </form>

                            <form action="{{ url_for('cambiar_rol', id_usuario=u.id) }}" method="POST" style="display:inline;">
                                <input type="hidden" name="rol" value="usuario">
                                <button class="btn gris small" {% if u.rol == 'usuario' %}disabled{% endif %}>Hacer Usuario</button>
                            </form>

                        {% else %}
                            <span class="badge admin">Admin protegido</span>
                        {% endif %}

                        <!-- ELIMINAR (POST) -->
                        {% if not es_admin_principal %}
                            <form action="{{ url_for('eliminar_usuario', id_usuario=u.id) }}" 
                                  method="POST" style="display:inline;"
                                  onsubmit="return confirm('¿Seguro que quieres eliminar este usuario?');">
                                <button class="btn rojo small">Eliminar</button>
                            </form>
                        {% endif %}

                    </td>
                </tr>

            {% endfor %}
            </tbody>
        </table>

    </div>
</section>
</main>

<footer class="main-footer">
    <p>&copy; 2025 OliSport — Todos los derechos reservados.</p>
    <div class="container">
        <p class="small">Panel de Administración</p>
        <ul>
            <li><a href="#"><i class="fab fa-facebook"></i></a></li>
            <li><a href="#"><i class="fab fa-instagram"></i></a></li>
            <li><a href="#"><i class="fab fa-youtube"></i></a></li>
        </ul>
    </div>
</footer>

<script>
    document.getElementById("hamburger").addEventListener("click", function () {
        const menu = document.getElementById("hamburgerMenu");
        menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    });
</script>

</body>
</html>
